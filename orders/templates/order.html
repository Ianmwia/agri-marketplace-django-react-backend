{% extends 'base.html' %}
{% load rest_framework %}


{% block content %}
<div x-data='{tab:"market"}' class="p-2 light:bg-#f9f9f9">
    <!--NAVIGATION BUTTONS-->
    <div class="flex flex-wrap gap-2 mb-6 justify-center">
        <button @click="tab = 'market'" :class="tab === 'market' ? 'bg-[#4a6d31] text-white' : 'bg-gray-200 text-black'" class="p-3 rounded font-bold cursor-pointer">Marketplace</button>
        <button @click="tab = 'orders'" :class="tab === 'orders' ? 'bg-[#4a6d31] text-white' : 'bg-gray-200 text-black'" class="p-3 rounded font-bold cursor-pointer">View Orders</button>
    </div>
    <div class="text-[30px] font-bold mb-4 text-center shadow-mb">Orders Market Place</div>

    <!--buyer marketplace-->
<div x-show="tab === 'market'" x-cloak class="mb-7 p-6 rounded-lg">
    {% if request.user.role == 'buyer' %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg-grid-cols-2 lg:grid-cols-3 gap-6 m-2">
        
        {% for item in available_produce %}
        <div class="shadow-lg rounded-lg p-2 bg-[#6c9f48]/40">
            <div class="flex items-center justify-center p-1 rounded-lg">
                {% if item.image %}
                    <img loading="lazy" class="bg-gray-300 h-[300px] w-[300px] rounded-sm object-cover object-center" src="{{ item.image.url }}" alt="{{ request.user.first_name }}">
                {% else %}
                    <img loading="lazy" class="bg-gray-300 h-[300px] w-[300px] rounded-sm object-cover object-center">                 
                {% endif %}
            </div>
            <div class="p-4 flex-col flex-grow">
                <div class="flex justify-between items start mb-2">
                    <h3 class="text-[18px] font-bold"><span class="text-[#001b20] font-bold">Name:</span> {{item.name|capfirst}}</h3>
                    <h3 class="text-[18px] font-bold"><span class="text-[#001b20] font-bold">Price Per Kilo:</span> {{item.price}}</h3>
                </div>
                <p class="mb-2 text-[18px]"><span class="text-[#001b20] font-bold">Farmer:</span> {{item.farmer.first_name}} {{item.farmer.last_name}}</p>
                <p class="mb-2 text-[18px]"><span class="text-[#001b20] font-bold">Stock Available in Kilo:</span> {{item.quantity}} KG</p>
            </div>
            <!--make an order-->
            <form action="{% url 'order-list' %}" enctype="multipart/form-data" method="post">
            {% csrf_token %}
            <input type="hidden" name="produce" value="{{ item.id }}">
            <div class="mt-2">
                <label for="">Order Quantity</label>
                <input class="p-1" type="text" placeholder="enter amount in kg" name=quantity min='1' max="{{ item.quantity }}" required>
                <button type="submit" class="mt-2 p-2 bg-[#6c9f48] text-white hover:cursor-pointer rounded-lg">Place Order</button>
            </div>
            </form>
        </div>
            
        {% endfor %}
            
    </div>
    <!--view orders placed -->
</div>

<!--view orders placed-->
<div x-show="tab === 'orders'" x-cloak class="mb-7 p-6 rounded-lg">
    {% endif %}
        <div class="p-3 rounded lg shadow-md border-gray-300">
            <h3 class="text-[30px] font-bold mb-2 border-b text-[#663399] text-center">Your orders</h3>
            <ul class="divide-y divide-gray-200 rounded-lg">
            {% for order in orders %}
                <li class="py-2 flex justify-between items-center text-gray-300 m-[27px] gap-2">
                    <span class="font-medium text-black dark:text-[#e8e8e4]">Order #{{ order.id }} </span>
                    <span class="font-medium text-black dark:text-[#e8e8e4]">For {{ order.produce.name|capfirst }} </span>
                    <span class="px-3 pt-1 rounded-full text-sm font-semibold">Status: {{ order.status }}</span>
                    <span class="text-sm text-gray-500 dark:text-[#e8e8e4]">Quantity in KG: {{order.quantity}}</span> 
                    <span class="text-sm text-gray-500 dark:text-[#e8e8e4]">Total Order Amount: KSH {{order.total_amount}}</span> 
                </li>
            {% empty %}
            <li class="py-4 text-gray-500 text-center">No orders Found</li>
                
            {% endfor %}
                </ul>
        </div>
</div>
</div>
{% endblock content %}
    